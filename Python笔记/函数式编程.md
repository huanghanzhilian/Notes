# 函数式编程
函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！
Python对函数式编程提供部分支持。由于Python允许使用变量，因此，Python不是纯函数式编程语言。

* 高阶函数(Higher-order function)
  变量可以指向函数，函数名也是变量，变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。
```python
def add(x, y, f):
    return f(x) + f(y)
add(5,-6,abs)
```

* map/reduce
  map()函数接收两个参数，一个是函数，一个是Iterable，map将传入的函数依次作用到序列的每个元素，并把结果作为新的Iterator返回。
```python
#map
def f(x):
    return x*x
r=map(f,list(range(10))[1::])
print(list(r))
```
reduce把一个函数作用在一个序列[x1, x2, x3, ...]上，这个函数必须接收两个参数，reduce把结果继续和序列的下一个元素做累积计算，其效果就是：`reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)`
```python
#reduce
from functools import reduce
def add(x, y):
    return x + y
    
print(reduce(add, [1, 3, 5, 7, 9]))
#25
```

利用map/reduce写一个str转成int的函数
```python
from functools import reduce

def str2int(s):
    def fn(x,y):
        return x*10+y
    def char2num(s):
        return {'0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9}[s]
    return reduce(fn,map(char2num,s))
    
#利用lambda简化
def str2int(s):
    return reduce(lambda x, y: x * 10 + y, map(char2num, s))
```

输入：['adam', 'LISA', 'barT']，输出：['Adam', 'Lisa', 'Bart']：
```python
def normalize(name):
    return name[0].upper()+name[1:].lower()
L1 = ['adam', 'LISA', 'barT']
L2 = list(map(normalize, L1))
print(L2)
```

利用reduce求积
```python
from functools import reduce
def prod(L):
    return(reduce(lambda x,y:x*y,L))
print('3 * 5 * 7 * 9 =', prod([3, 5, 7, 9]))
```

利用map和reduce编写一个str2float函数，把字符串'123.456'转换成浮点数123.456
```python
from functools import reduce
def str2float(s):
    return reduce(lambda x,y:10*x+y,map(int,s[:s.find('.')])) + reduce(lambda x,y:x/10 + y,(map(int,s[-1:s.find('.'):-1])))/10
print('str2float(\'123.456\') =', str2float('123.456'))
```

* filter
  Python内建的filter()函数用于过滤序列。和map()类似，filter()也接收一个函数和一个序列。和map()不同的是，filter()把传入的函数依次作用于每个元素，然后根据返回值是True还是False决定保留还是丢弃该元素。

使用filter求素数
```python
#奇数生成器
def _odd_iter():
    n=1
    while True:
        n = n + 2
        yield n
#筛选函数
def _not_divisible(n):
    return lambda x:x%n>0
#定义生成器，返回素数
def primes():
    yield 2
    it=_odd_iter()
    while True：
        n=next(it)
        yield n
        it = filter(_not_divisible(n),it)
# 打印1000以内的素数:
for n in primes():
    if n < 1000:
        print(n)
    else:
        break
```

* sorted
  Python内置的sorted()函数就可以对list进行排序，此外，sorted()函数也是一个高阶函数，它还可以接收一个key函数来实现自定义的排序。
```python
#按绝对值大小排序
sorted([36, 5, -12, 9, -21], key=abs)
```
要进行反向排序，不必改动key函数，可以传入第三个参数reverse=True
```python
sorted(['bob', 'about', 'Zoo', 'Credit'], key=str.lower, reverse=True)
```

* 函数作为返回值