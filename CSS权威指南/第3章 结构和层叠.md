# 第3章 结构和层叠
继承（Inheritance）是从一个元素向其后代元素传递属性值所采用的机制。确定应当向一个元素应用哪些值时，用户代理不仅要考虑继承，还要考虑声明的特殊性，另外需要考虑声明本身的来源。这个过程就称为层叠（cascade）。本章将讨论这3种机制之间的关联：特殊性、继承和层叠。
## 特殊性
对于每个规则，用户代理会计算选择器的特殊性，并将这个特殊性附加到规则中的各个声明。如果一个元素有两个或多个冲突的属性声明，那么有最高特殊性的声明就会胜出。

> 注意：这并不是解决冲突的全部。实际上，所有样式冲突的解决都由层叠来处理，本章后面专设了一节介绍这个内容。

选择器的特殊性由选择器本身的组件确定。特殊性值表述为4个部分，如：0，0，0，0。一个选择器的具体特殊性如下确定：
* 对于选择器中给定的各个ID属性值，加0，1，0，0。
* 对于选择器中给定的各个类属性值，属性选择或伪类，加0，0，1，0。
* 对于选择器中给定的各个元素和伪元素，加0，0，0，1。伪元素是否有特殊性，在这方面css2有些自相矛盾，不过css2.1很清楚的指出，伪元素有特殊性，而且其特殊性为0，0，0，1。
* 结合符和通配符选择器对特殊性没有任何贡献

```css
h1{color:red;}/* specifity = 0,0,0,1 */
p em{color:purple;}/* specifity = 0,0,0,2 */
.grape{color:purple;}/* specifity = 0,0,1,0 */
*.bright{color:yellow;}/* specifity = 0,0,1,0 */
p.bright em.dark{color:maroon;}/* specifity = 0,0,2,2 */
#id216{color:blue;}/* specifity = 0,1,0,0 */
div#sidebar *[href]{color:silver;}/* specifity = 0,1,1,1 */
```

### 内联样式特殊性
一般地，第一个0是为内联样式声明保留的，它比所有其他声明的特殊性都高。

> 注意：为内联样式声明保留一位，这是CSS2.1才新增的，这样做是为了反映写CSS2.1当时的Web 浏览器表现。在CSS2中，内联样式声明的特殊性是1,0,0 (CSS2特殊性包含3个值，而不是4个）。换句话说，它与ID选择器的特殊性相同，所以ID选择器很容易覆盖内联样式。

### 重要性
有时某个声明可能非常重要，超过了所有其他声明。CSS2.1称之为重要声明（原因显而易见），并允许在这些声明的结束分号之前插入！important来标志。
```css
p.dark {color:#333 !important; background: white;}
```
必须正确地放置!important,否则声明将无效。！ important总是放在声明的最后，即分号前面。如果一个属性的值可以包含多个关键词，如font,这一点则尤其重要，必须将!important标志放在声明的最后：`p.light {color: yellow; font: smaller Times, serif !important;}`
标志为!important的声明并没有特殊的特殊性值，不过要与非重要声明分开考虑。实际上，所有!important声明会分组在一起，重要声明的特殊性冲突会在重要声明内部解决，而不会与非重要声明相混。

## 继承
基于继承机制，样式不仅应用到指定的元素，还会应用到它的后代元素。

> 注意：在HTML中，对于向上传播规则有一个例外：应用到body元素的背景样式可以传递到html元素（html是文档的根元素），相应地可以定义其画布。

一般地，大多数框模型属性（包括外边距、内边距、背景和边框）都不能继承。继承的值根本没有特殊性，甚至连0特殊性都没有。
```
*{color: gray;}
h1#page-title {color:black;}
<h1 id="page-title">Meerkat <em>Central</em></h1>
<p>
Welcome to the best place on the web for meerkat information!
</p>
<!--Central为灰色，因为通配选择器适用于所有元素，而且有0特殊性，其颜色声明指定的值gray要优先于继承值（black）,因为继承值根本没有特殊性。因此，em元素会显示为灰色而不是黑色。-->
```

## 层叠
CSS2.1的层叠规则：
* 找出所有相关的规则，这些规则都包含与一个给定元素匹配的选择器。
* 按显式权重对应用到该元素的所有声明排序。标志!important的规则的权重要高于没有!important标志的规则。按来源对应用到给定元素的所有声明排序。共有3种来源：创作人员、读者和用户代理。正常情况下，创作人员的样式要胜过读者的样式。有!important标志的读者样式要强干所有其他样式，这包括有!important标志的创作人员样式。创作人员样式和读者样式都比用户代理的默认样式要强。
* 按特殊性对应用到给定元素的所有声明排序。有较高特殊性的元素权重要大于有较低特殊性的元素。
* 按出现顺序对应用到给定元素的所有声明排序。一个声明在样式表或文档中越后出现，它的权重就越大。如果样式表中有导入的样式表，一般认为出现在导入样式表中的声明在前，主样式表中的所有声明在后。

### 按权重和来源排序
权重由大到小的顺序依次为：
1. 读者的重要声明
2. 创作人员的重要声明
3. 创作人员的正常声明
4. 读者的正常声明
5. 用户代理声明

### 按特殊性排序
如果向一个元素应用多个彼此冲突的声明，而且它们的权重相同，则要按特殊性排序，最特殊的声明最优先。

### 按顺序排序
如果两个规则的权重、来源和特殊性完全相同，那么在样式表中后出现的一个会胜出。
正是由于这种按顺序排序，所以才有了通常推荐的链接样式顺序。一般建议按link-visited-hover-active (LVHA)的顺序声明链接样式如下：
```css
:link {color: blue;}
:visited {color: purple;}
:hover {color: red;}
:active {color: orange;}
```
